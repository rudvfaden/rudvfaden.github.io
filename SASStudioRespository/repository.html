<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width"><title>https://sassoftware.github.io/sas-studio-tasks/contributed/tasktuesdays/repository.html</title><link rel="stylesheet" type="text/css" href="repository_files/viewsource.css"></head><body id="viewsource" class="highlight" style="-moz-tab-size: 4" contextmenu="actions"><pre id="line1"><span></span><span class="doctype">&lt;!DOCTYPE html&gt;</span><span> 
<span id="line2"></span></span><span>&lt;<span class="start-tag">html</span>&gt;</span><span>
<span id="line3"></span>  </span><span>&lt;<span class="start-tag">head</span>&gt;</span><span> 
<span id="line4"></span>  </span><span>&lt;<span class="start-tag">meta</span> <span class="attribute-name">http-equiv</span>="<a class="attribute-value">X-UA-Compatible</a>" <span class="attribute-name">content</span>="<a class="attribute-value">IE=edge,chrome=1</a>"&gt;</span><span>
<span id="line5"></span>  </span><span>&lt;<span class="start-tag">link</span> <span class="attribute-name">rel</span>="<a class="attribute-value">shortcut icon</a>" <span class="attribute-name">type</span>="<a class="attribute-value">image/x-icon</a>" <span class="attribute-name">href</span>="<a class="attribute-value" href="view-source:http://sww.sas.com/favicon.ico">http://sww.sas.com/favicon.ico</a>" <span>/</span>&gt;</span><span>
<span id="line6"></span>  </span><span>&lt;<span class="start-tag">title</span>&gt;</span><span> SAS Studio Repository </span><span>&lt;/<span class="end-tag">title</span>&gt;</span><span>
<span id="line7"></span>   </span><span>&lt;/<span class="end-tag">head</span>&gt;</span><span>
<span id="line8"></span>
<span id="line9"></span></span><span class="error" title="“script” element between “head” and “body”.">&lt;<span class="start-tag">script</span>&gt;</span><span>
<span id="line10"></span>/**
<span id="line11"></span> * This allows a SAS Studio Repository to be loaded from another domain than SAS Studio.
<span id="line12"></span> * An one time id is generated by SAS Studio and then this proxy is called with the that id.
<span id="line13"></span> * If the content loads the content is passed back to the SAS Studio domain using the id and
<span id="line14"></span> * the window.postMessage() protocol. This ensure cross domain communication without having
<span id="line15"></span> * to modify the configuration of the hosting web server or container (this CORS).
<span id="line16"></span> */
<span id="line17"></span>/* Resolve all URL parameters passed to the proxy. */
<span id="line18"></span>function getUrlVars() {
<span id="line19"></span>    var vars = {};
<span id="line20"></span>    var parts = window.location.href.replace(/[?&amp;]+([^=&amp;]+)=([^&amp;]*)/gi,
<span id="line21"></span>            function (m, key, value) {
<span id="line22"></span>            vars[key] = value;
<span id="line23"></span>        });
<span id="line24"></span>    return vars;
<span id="line25"></span>}
<span id="line26"></span>/* Resolve the current URL for any relative URLs contained in the repository. */
<span id="line27"></span>function getBaseUrl(url) {
<span id="line28"></span>    var querypos = url.indexOf("?");
<span id="line29"></span>    if (querypos &gt; 0)
<span id="line30"></span>        url = url.substring(0, querypos);
<span id="line31"></span>    var parts = url.split("/");
<span id="line32"></span>    var last = parts[parts.length - 1];
<span id="line33"></span>    var pos = url.indexOf(last);
<span id="line34"></span>    return url.substring(0, pos - 1);
<span id="line35"></span>}
<span id="line36"></span>/* Global parameters for the proxy. */
<span id="line37"></span>var objects = new Object();
<span id="line38"></span>var version = 7;
<span id="line39"></span>var taskCategories = null;
<span id="line40"></span>var snippetCategories = null;
<span id="line41"></span>var repositoryDocument = null;
<span id="line42"></span>var baseURL = getBaseUrl(window.location.href);
<span id="line43"></span>var parms = getUrlVars();
<span id="line44"></span>RegExp.escape = function (text) {
<span id="line45"></span>    return text.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&amp;");
<span id="line46"></span>}
<span id="line47"></span>String.prototype.replaceAll = function (search, replace) {
<span id="line48"></span>    return this.replace(new RegExp(RegExp.escape(search), 'g'), replace);
<span id="line49"></span>};
<span id="line50"></span>/* In addition to be the proxy the loader validates the XML integrity of the repository. */
<span id="line51"></span>/* Invalid XML is flagged in the loader page, but is not passed back to SAS Studio.      */
<span id="line52"></span>function buildRepository(xmlhttp) {
<span id="line53"></span>    try {
<span id="line54"></span>        var s = new XMLSerializer();
<span id="line55"></span>        parser = new DOMParser();
<span id="line56"></span>        addNote("Starting validation of " + xmlhttp.responseURL);
<span id="line57"></span>        repositoryDocument = parseXml(xmlhttp.responseText);
<span id="line58"></span>        var categories = [];
<span id="line59"></span>        /* Check for a top-level repository icon. If the URI is relative resolve it. */
<span id="line60"></span>        try {
<span id="line61"></span>            var repositoryIcon = repositoryDocument.getElementsByTagName("Icon")[0];
<span id="line62"></span>            var iconUri = repositoryIcon.getAttribute("uri");
<span id="line63"></span>            if (iconUri) {
<span id="line64"></span>                if (iconUri.indexOf(".") == 0)
<span id="line65"></span>                    iconUri = baseURL + iconUri.substring(1);
<span id="line66"></span>                //console.log(iconUri);
<span id="line67"></span>                repositoryIcon.setAttribute("uri", iconUri);
<span id="line68"></span>                var img = "</span><span>&lt;i</span><span>mg width=16 height=16 src=\'" + iconUri + "'/&gt;";
<span id="line69"></span>                addNote("Repository icon is " + img);
<span id="line70"></span>            }
<span id="line71"></span>        } catch (e) {
<span id="line72"></span>            //          console.log("No repository icon element found.");
<span id="line73"></span>        }
<span id="line74"></span>        var documentation = null;
<span id="line75"></span>        repositoryTags = repositoryDocument.getElementsByTagName("Repository");
<span id="line76"></span>        if (repositoryTags.length == 1) {
<span id="line77"></span>            documentation = new Array();
<span id="line78"></span>            repositoryTag = repositoryTags[0];
<span id="line79"></span>            for (i = 0; i </span><span>&lt; </span><span>repositoryTag.childNodes.length; i++) {
<span id="line80"></span>                if (repositoryTag.childNodes[i].nodeName == "Documentation")
<span id="line81"></span>                    documentation.push(repositoryTag.childNodes[i]);
<span id="line82"></span>            }
<span id="line83"></span>            //          console.log(documentation);
<span id="line84"></span>        }
<span id="line85"></span>        /**
<span id="line86"></span>         * See if the repository itself has documentation.
<span id="line87"></span>         */
<span id="line88"></span>        if (documentation &amp;&amp; documentation.length &gt; 1) {
<span id="line89"></span>            for (i = 0; i </span><span>&lt; </span><span>documentation.length; i++) {
<span id="line90"></span>                docUri = documentation[i].getAttribute("uri");
<span id="line91"></span>                var docLabel = documentation[i].getAttribute("label");
<span id="line92"></span>                if (!docLabel)
<span id="line93"></span>                    docLabel = docUri;
<span id="line94"></span>                var docURL = docUri;
<span id="line95"></span>                if (docURL.indexOf(".") == 0)
<span id="line96"></span>                    docURL = baseURL + docUri.substring(1);
<span id="line97"></span>                var docLink = "</span><span>&lt;a</span><span> target='_blank' href='" + docURL + "'&gt;" + docLabel + "</span><span>&lt;/<span></span>a</span><span>&gt;";
<span id="line98"></span>                addNote("A repository documentation link is located at " + docLink);
<span id="line99"></span>                documentation[i].setAttribute("uri", docURL);
<span id="line100"></span>            }
<span id="line101"></span>        }
<span id="line102"></span>        /* Validate all task category definitions. */
<span id="line103"></span>        var tasks = repositoryDocument.getElementsByTagName("Tasks");
<span id="line104"></span>        if (tasks.length == 1)
<span id="line105"></span>            taskCategories = tasks[0].getElementsByTagName("Category");
<span id="line106"></span>        if (taskCategories) {
<span id="line107"></span>            var tasks = window.document.getElementById("tasks");
<span id="line108"></span>            var html = "</span><span>&lt;h</span><span>4&gt;Task Categories:</span><span>&lt;/<span></span>h</span><span>4&gt;</span><span>&lt;u</span><span>l&gt;";
<span id="line109"></span>            for (i = 0; i </span><span>&lt; </span><span>taskCategories.length; i++) {
<span id="line110"></span>                html += validateCategory("Task", taskCategories[i]);
<span id="line111"></span>            }
<span id="line112"></span>            html += "</span><span>&lt;/<span></span>u</span><span>l&gt;";
<span id="line113"></span>            tasks.innerHTML = html;
<span id="line114"></span>        }
<span id="line115"></span>        /* Validate all snippet category definitions. */
<span id="line116"></span>        var snippets = repositoryDocument.getElementsByTagName("Snippets");
<span id="line117"></span>        if (snippets.length == 1)
<span id="line118"></span>            snippetCategories = snippets[0].getElementsByTagName("Category");
<span id="line119"></span>        if (snippetCategories) {
<span id="line120"></span>            var snippets = window.document.getElementById("snippets");
<span id="line121"></span>            var html = "</span><span>&lt;h</span><span>4&gt;Snippet Categories:</span><span>&lt;/<span></span>h</span><span>4&gt;</span><span>&lt;u</span><span>l&gt;";
<span id="line122"></span>            for (i = 0; i </span><span>&lt; </span><span>snippetCategories.length; i++) {
<span id="line123"></span>                html += validateCategory("Snippet", snippetCategories[i]);
<span id="line124"></span>            }
<span id="line125"></span>            html += "</span><span>&lt;/<span></span>u</span><span>l&gt;";
<span id="line126"></span>            snippets.innerHTML = html;
<span id="line127"></span>        }
<span id="line128"></span>        addNote("Task repository validation completed.");
<span id="line129"></span>        /* Serialize the XML to make sure resolved URI are updated. */
<span id="line130"></span>        processedXML = s.serializeToString(repositoryDocument);
<span id="line131"></span>        objects["repository.xml"] = processedXML;
<span id="line132"></span>        objects["event"] = "loaded";
<span id="line133"></span>        objects["version"] = version;
<span id="line134"></span>        objects["status"] = 200;
<span id="line135"></span>        /* Pass payload back to SAS Studio. */
<span id="line136"></span>        if (parms["target"]) {
<span id="line137"></span>            objects.id = parms["id"];
<span id="line138"></span>            objects.type = "proxy";
<span id="line139"></span>            window.parent.postMessage(objects, parms["target"]);
<span id="line140"></span>        }
<span id="line141"></span>    } catch (e) {
<span id="line142"></span>        addError("Fatal repository condition encountered.");
<span id="line143"></span>        addError(e.toString());
<span id="line144"></span>    }
<span id="line145"></span>}
<span id="line146"></span>/**
<span id="line147"></span> * Do all the tedious category validation in one place. For performance reasons we don't validate
<span id="line148"></span> * the category content itself. We leave to be done on the SAS Studio side.
<span id="line149"></span> */
<span id="line150"></span>function validateCategory(type, node) {
<span id="line151"></span>    var s = new XMLSerializer();
<span id="line152"></span>    var label = node.getAttribute("label");
<span id="line153"></span>    var location = node.getElementsByTagName("Location");
<span id="line154"></span>    var uri = location[0].getAttribute("uri");
<span id="line155"></span>    var resolvedURL = uri;
<span id="line156"></span>    var validateURL = uri;
<span id="line157"></span>    var iconUri = null;
<span id="line158"></span>    var catLabel = "";
<span id="line159"></span>    if (resolvedURL.indexOf(".") == 0)
<span id="line160"></span>        resolvedURL = baseURL + uri.substring(1)
<span id="line161"></span>            location[0].setAttribute("uri", resolvedURL);
<span id="line162"></span>    var link = "</span><span>&lt;a</span><span> target='_blank' href='" + resolvedURL + "'&gt;" + resolvedURL + "</span><span>&lt;/<span></span>a</span><span>&gt;";
<span id="line163"></span>    var html = "</span><span>&lt;l</span><span>i&gt;" + label + " - " + link + "</span><span>&lt;/<span></span>l</span><span>i&gt;";
<span id="line164"></span>    addNote("Validating '" + label + "' " + type + " category.");
<span id="line165"></span>    catLabel = label;
<span id="line166"></span>    /**
<span id="line167"></span>     * See if the category itself has documentation.
<span id="line168"></span>     */
<span id="line169"></span>    var documentation = node.getElementsByTagName("Documentation");
<span id="line170"></span>    if (documentation &amp;&amp; documentation.length &gt;= 1) {
<span id="line171"></span>        for (var i = 0; i </span><span>&lt; </span><span>documentation.length; i++) {
<span id="line172"></span>            docUri = documentation[i].getAttribute("uri");
<span id="line173"></span>            var docLabel = documentation[i].getAttribute("label");
<span id="line174"></span>            if (!docLabel)
<span id="line175"></span>                docLabel = docUri;
<span id="line176"></span>            var docURL = docUri;
<span id="line177"></span>            if (docURL.indexOf(".") == 0)
<span id="line178"></span>                docURL = baseURL + docUri.substring(1);
<span id="line179"></span>            var docLink = "</span><span>&lt;a</span><span> target='_blank' href='" + docURL + "'&gt;" + docLabel + "</span><span>&lt;/<span></span>a</span><span>&gt;";
<span id="line180"></span>            addNote("A category documentation link is located at " + docLink);
<span id="line181"></span>            documentation[i].setAttribute("uri", docURL);
<span id="line182"></span>        }
<span id="line183"></span>    }
<span id="line184"></span>    var xhr = new XMLHttpRequest();
<span id="line185"></span>    var taskBase = getBaseUrl(resolvedURL);
<span id="line186"></span>    xhr.onreadystatechange = function () {
<span id="line187"></span>        try {
<span id="line188"></span>            if (xhr.readyState == 4 &amp;&amp; xhr.status == 200) {
<span id="line189"></span>                try {
<span id="line190"></span>                    doc = parseXml(xhr.responseText);
<span id="line191"></span>                } catch (e) {
<span id="line192"></span>                    addError(resolvedURL + " failed to parse as XML.");
<span id="line193"></span>                    addError(e);
<span id="line194"></span>                    addWarning("Category '" + label + "' will be ignored.");
<span id="line195"></span>                    return html;
<span id="line196"></span>                }
<span id="line197"></span>                var tags = doc.getElementsByTagName(type);
<span id="line198"></span>                addNote("'" + label + "' " + type + " category contains " + tags.length + " items.");
<span id="line199"></span>                for (j = 0; j </span><span>&lt; </span><span>tags.length; j++) {
<span id="line200"></span>                    var tag = tags[j];
<span id="line201"></span>                    if (tag.getElementsByTagName("Name").length == 0) {
<span id="line202"></span>                        addError("Required tag \"</span><span>&lt;b</span><span>&gt;Name</span><span>&lt;/<span></span>b</span><span>&gt;\" missing from </span><span>&lt;a</span><span> href='" + validateURL + "'&gt;" + validateURL + "</span><span>&lt;/<span></span>a</span><span>&gt;");
<span id="line203"></span>                        addError(type + " after \"</span><span>&lt;b</span><span>&gt;" + label + "</span><span>&lt;/<span></span>b</span><span>&gt;\" is invalid.");
<span id="line204"></span>                        addWarning("Entire category \"</span><span>&lt;b</span><span>&gt;" + catLabel + "</span><span>&lt;/<span></span>b</span><span>&gt;\" will be discarded.");
<span id="line205"></span>                        return html;
<span id="line206"></span>                    }
<span id="line207"></span>                    if (tag.getElementsByTagName("Template").length == 0) {
<span id="line208"></span>                        addError("Required tag \"</span><span>&lt;b</span><span>&gt;Template</span><span>&lt;/<span></span>b</span><span>&gt;\" missing from </span><span>&lt;a</span><span> href='" + validateURL + "'&gt;" + validateURL + "</span><span>&lt;/<span></span>a</span><span>&gt;");
<span id="line209"></span>                        addError(type + " after \"</span><span>&lt;b</span><span>&gt;" + label + "</span><span>&lt;/<span></span>b</span><span>&gt;\" is invalid.");
<span id="line210"></span>                        addWarning("Entire category \"</span><span>&lt;b</span><span>&gt;" + catLabel + "</span><span>&lt;/<span></span>b</span><span>&gt;\" will be discarded.");
<span id="line211"></span>                        return html;
<span id="line212"></span>                    }
<span id="line213"></span>                    nameTag = tag.getElementsByTagName("Name")[0];
<span id="line214"></span>                    templateTag = tag.getElementsByTagName("Template")[0];
<span id="line215"></span>                    label = nameTag.getAttribute("label");
<span id="line216"></span>                    templateUri = templateTag.getAttribute("uri");
<span id="line217"></span>                    iconUri = null;
<span id="line218"></span>                    var icon = tag.getElementsByTagName("Icon");
<span id="line219"></span>                    if (icon &amp;&amp; icon.length == 1) {
<span id="line220"></span>                        iconTag = tag.getElementsByTagName("Icon")[0];
<span id="line221"></span>                        iconUri = iconTag.getAttribute("uri");
<span id="line222"></span>                        if (iconUri) {
<span id="line223"></span>                            if (iconUri.indexOf(".") == 0)
<span id="line224"></span>                                iconUri = taskBase + iconUri.substring(1);
<span id="line225"></span>                            iconTag.setAttribute("uri", iconUri);
<span id="line226"></span>                        }
<span id="line227"></span>                    }
<span id="line228"></span>                    var documentation = tag.getElementsByTagName("Documentation");
<span id="line229"></span>                    if (documentation &amp;&amp; documentation.length &gt;= 1) {
<span id="line230"></span>                        for (var i = 0; i </span><span>&lt; </span><span>documentation.length; i++) {
<span id="line231"></span>                            docUri = documentation[i].getAttribute("uri");
<span id="line232"></span>                            var docLabel = documentation[i].getAttribute("label");
<span id="line233"></span>                            if (!docLabel)
<span id="line234"></span>                                docLabel = docUri;
<span id="line235"></span>                            var docURL = docUri;
<span id="line236"></span>                            if (docURL.indexOf(".") == 0)
<span id="line237"></span>                                docURL = taskBase + docUri.substring(1);
<span id="line238"></span>                            var docLink = "</span><span>&lt;a</span><span> target='_blank' href='" + docURL + "'&gt;" + docLabel + "</span><span>&lt;/<span></span>a</span><span>&gt;";
<span id="line239"></span>                            addNote("A '" + label + "' documentation link is located at " + docLink);
<span id="line240"></span>                            documentation[i].setAttribute("uri", docURL);
<span id="line241"></span>                        }
<span id="line242"></span>                    }
<span id="line243"></span>                    if (templateUri.indexOf(".") == 0)
<span id="line244"></span>                        templateUri = taskBase + templateUri.substring(1);
<span id="line245"></span>                    templateTag.setAttribute("uri", templateUri);
<span id="line246"></span>                    var note = "'" + label + "' contents is located at </span><span>&lt;a</span><span> target='_blank' + href='" + templateUri + "'&gt;" + templateUri + "</span><span>&lt;/<span></span>a</span><span>&gt;";
<span id="line247"></span>                    addNote(note);
<span id="line248"></span>                    if (iconUri) {
<span id="line249"></span>                        var img = "</span><span>&lt;i</span><span>mg width=16 height=16 src=\'" + iconUri + "'/&gt;";
<span id="line250"></span>                        addNote(type + " icon for " + label + " is " + img);
<span id="line251"></span>                    }
<span id="line252"></span>                }
<span id="line253"></span>                processedXML = s.serializeToString(doc);
<span id="line254"></span>                objects[resolvedURL] = processedXML;
<span id="line255"></span>            } else if (xhr.readyState == 4 &amp;&amp; xhr.status == 404) {
<span id="line256"></span>                addWarning(resolvedURL + " not found.");
<span id="line257"></span>                xhr.abort();
<span id="line258"></span>            }
<span id="line259"></span>        } catch (e) {
<span id="line260"></span>            console.log(e);
<span id="line261"></span>        }
<span id="line262"></span>    }
<span id="line263"></span>    validateURL = resolvedURL;
<span id="line264"></span>    xhr.open("GET", resolvedURL, false);
<span id="line265"></span>    try {
<span id="line266"></span>        xhr.send();
<span id="line267"></span>    } catch (e) {
<span id="line268"></span>        addWarning(e);
<span id="line269"></span>    }
<span id="line270"></span>    return html;
<span id="line271"></span>}
<span id="line272"></span>/**
<span id="line273"></span> * Format a validation note.
<span id="line274"></span> */
<span id="line275"></span>function addNote(note) {
<span id="line276"></span>    message = window.document.getElementById("message");
<span id="line277"></span>    var html = "</span><span>&lt;d</span><span>iv style='color:blue'&gt;NOTE: " + note + "</span><span>&lt;/<span></span>d</span><span>iv&gt;";
<span id="line278"></span>    message.innerHTML += html;
<span id="line279"></span>}
<span id="line280"></span>/**
<span id="line281"></span> * Format a validation warning.
<span id="line282"></span> */
<span id="line283"></span>function addWarning(warning) {
<span id="line284"></span>    message = window.document.getElementById("message");
<span id="line285"></span>    var html = "</span><span>&lt;d</span><span>iv style='color:green'&gt;WARNING: " + warning + "</span><span>&lt;/<span></span>d</span><span>iv&gt;";
<span id="line286"></span>    message.innerHTML += html;
<span id="line287"></span>}
<span id="line288"></span>/*
<span id="line289"></span> * Format a validation error.
<span id="line290"></span> */
<span id="line291"></span>function addError(error) {
<span id="line292"></span>    message = window.document.getElementById("message");
<span id="line293"></span>    var html = "</span><span>&lt;d</span><span>iv style='color:red'&gt;ERROR: " + error + "</span><span>&lt;/<span></span>d</span><span>iv&gt;";
<span id="line294"></span>    message.innerHTML += html;
<span id="line295"></span>}
<span id="line296"></span>/*
<span id="line297"></span> * Utility function for parsing some XML.
<span id="line298"></span> */
<span id="line299"></span>function parseXml(xmlString) {
<span id="line300"></span>    var parser = new DOMParser();
<span id="line301"></span>    var dom = parser.parseFromString(xmlString, 'text/xml');
<span id="line302"></span>    errors = dom.getElementsByTagName("parsererror");
<span id="line303"></span>    if (errors.length &gt; 0)
<span id="line304"></span>        throw new Error(errors[0].innerHTML);
<span id="line305"></span>    return dom;
<span id="line306"></span>}
<span id="line307"></span>/*
<span id="line308"></span> * The proxy sends and receives. The receive sends back an "echo".
<span id="line309"></span> * Receive sends back and "echo".
<span id="line310"></span> */
<span id="line311"></span>function receiveData(event) {
<span id="line312"></span>    event.data.type = "echo";
<span id="line313"></span>    event.data.domain = window.domain;
<span id="line314"></span>    event.source.postMessage(event.data, event.origin);
<span id="line315"></span>}
<span id="line316"></span>/*
<span id="line317"></span> * Proxy main equivalent.
<span id="line318"></span> */
<span id="line319"></span>function onLoad() {
<span id="line320"></span>    try {
<span id="line321"></span>        if (window.addEventListener)
<span id="line322"></span>            window.addEventListener("message", receiveData, false);
<span id="line323"></span>        else
<span id="line324"></span>            if (window.attachEvent)
<span id="line325"></span>                window.attachEvent("onmessage", receiveData);
<span id="line326"></span>        var root = false;
<span id="line327"></span>        var resourceRoot = baseURL;
<span id="line328"></span>        var div = window.document.getElementById("url");
<span id="line329"></span>        div.innerHTML = "</span><span>&lt;l</span><span>i&gt;" + baseURL + "</span><span>&lt;/<span></span>l</span><span>i&gt;";
<span id="line330"></span>        /**
<span id="line331"></span>         * target is the generated ID for proxy loading - SAS Studio generates this.
<span id="line332"></span>         */
<span id="line333"></span>        if (parms["target"]) {
<span id="line334"></span>            /**
<span id="line335"></span>             * Send back an event that the proxy was loaded and started processing.
<span id="line336"></span>             */
<span id="line337"></span>            var object = new Object();
<span id="line338"></span>            object.event = "onloadstart";
<span id="line339"></span>            object.status = 200;
<span id="line340"></span>            object.type = "proxy";
<span id="line341"></span>            object.version = version;
<span id="line342"></span>            object.id = parms["id"];
<span id="line343"></span>            //console.log(object);
<span id="line344"></span>            window.parent.postMessage(object, parms["target"]);
<span id="line345"></span>            if (parms["noload"]) return;
<span id="line346"></span>        }
<span id="line347"></span>        /**
<span id="line348"></span>         * If no uri is passed to the proxy, then the repository itself is loaded.
<span id="line349"></span>         * If a uri is passed we are loading repository content.
<span id="line350"></span>         */
<span id="line351"></span>        xmlhttp = new XMLHttpRequest();
<span id="line352"></span>        xmlhttp.onreadystatechange = function () {
<span id="line353"></span>            /* Successful load. */
<span id="line354"></span>            try {
<span id="line355"></span>                if (xmlhttp.readyState == 4 &amp;&amp; xmlhttp.status == 200) {
<span id="line356"></span>                    if (root) {
<span id="line357"></span>                        buildRepository(xmlhttp);
<span id="line358"></span>                    } else {
<span id="line359"></span>                        var object = new Object();
<span id="line360"></span>                        object.event = "loaded";
<span id="line361"></span>                        object.status = 200;
<span id="line362"></span>                        object.type = "proxy";
<span id="line363"></span>						object.version = version;
<span id="line364"></span>                        object.id = parms["id"];
<span id="line365"></span>                        //console.log(xmlhttp.responseText);
<span id="line366"></span>                        //console.log(object);
<span id="line367"></span>                        //console.log(baseURL);
<span id="line368"></span>                        var content = xmlhttp.responseText;
<span id="line369"></span>                        try {
<span id="line370"></span>                            content = content.replaceAll("{baseURL}", resourceRoot);
<span id="line371"></span>                        } catch (e) {
<span id="line372"></span>                            console.log("Error substituting {baseURL}.");
<span id="line373"></span>                        }
<span id="line374"></span>                        object.content = content;
<span id="line375"></span>                        window.parent.postMessage(object, parms["target"]);
<span id="line376"></span>                    }
<span id="line377"></span>                }
<span id="line378"></span>                /* Not so successful. */
<span id="line379"></span>                else if (xmlhttp.readyState == 4 &amp;&amp; xmlhttp.status == 404) {
<span id="line380"></span>                    //console.log( xmlhttp.responseURL + " (" + xmlhttp.statusText + ")" );
<span id="line381"></span>                    var object = new Object();
<span id="line382"></span>                    object.event = "error";
<span id="line383"></span>					object.version = version;
<span id="line384"></span>                    object.status = xmlhttp.status;
<span id="line385"></span>                    object.message = xmlhttp.statusText;
<span id="line386"></span>                    object.url = xmlhttp.responseURL;
<span id="line387"></span>                    object.id = parms["id"];
<span id="line388"></span>                    object.type = "proxy";
<span id="line389"></span>                    console.log(object);
<span id="line390"></span>                    xmlhttp.abort();
<span id="line391"></span>                    window.parent.postMessage(object, parms["target"]);
<span id="line392"></span>                }
<span id="line393"></span>            } catch (e) {
<span id="line394"></span>                console.log(e);
<span id="line395"></span>            }
<span id="line396"></span>        }
<span id="line397"></span>        /* No URI - load repository itself. */
<span id="line398"></span>        /* A URI specified - load content repository. */
<span id="line399"></span>        uri = parms["uri"];
<span id="line400"></span>        if (!uri) {
<span id="line401"></span>            root = true;
<span id="line402"></span>            uri = "./repository.xml";
<span id="line403"></span>        } else {
<span id="line404"></span>            resourceRoot = getBaseUrl(uri);
<span id="line405"></span>            if (parms["target"])
<span id="line406"></span>                uri += "?id=" + parms["id"];
<span id="line407"></span>            //console.log(uri);
<span id="line408"></span>        }
<span id="line409"></span>        xmlhttp.open("GET", uri);
<span id="line410"></span>        xmlhttp.send();
<span id="line411"></span>    } catch (e) {
<span id="line412"></span>        console.log(e);
<span id="line413"></span>    }
<span id="line414"></span>}
<span id="line415"></span> 
<span id="line416"></span></span><span>&lt;/<span class="end-tag">script</span>&gt;</span><span>
<span id="line417"></span>   </span><span>&lt;<span class="start-tag">body</span> <span class="attribute-name">onload</span>="<a class="attribute-value">try { onLoad(); } catch (e) { console.log(e); }</a>"&gt;</span><span>
<span id="line418"></span>   </span><span>&lt;<span class="start-tag">h2</span>&gt;</span><span>SAS Studio 3.5 Repository</span><span>&lt;/<span class="end-tag">h2</span>&gt;</span><span>
<span id="line419"></span>   </span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>
<span id="line420"></span>   Proxy loader and repository validation page.
<span id="line421"></span>   </span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>
<span id="line422"></span>   </span><span>&lt;<span class="start-tag">h4</span>&gt;</span><span>Access URL:</span><span>&lt;/<span class="end-tag">h4</span>&gt;</span><span>
<span id="line423"></span>   </span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>
<span id="line424"></span>   </span><span>&lt;<span class="start-tag">ul</span>&gt;</span><span>
<span id="line425"></span>   </span><span>&lt;<span class="start-tag">div</span> <span class="attribute-name">id</span>="<a class="attribute-value">url</a>"&gt;</span><span></span><span>&lt;/<span class="end-tag">div</span>&gt;</span><span>
<span id="line426"></span>   </span><span>&lt;/<span class="end-tag">ul</span>&gt;</span><span>
<span id="line427"></span>   </span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>
<span id="line428"></span>   </span><span>&lt;<span class="start-tag">div</span> <span class="attribute-name">id</span>="<a class="attribute-value">tasks</a>"&gt;</span><span></span><span>&lt;/<span class="end-tag">div</span>&gt;</span><span>
<span id="line429"></span>   </span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>
<span id="line430"></span>   </span><span>&lt;<span class="start-tag">div</span> <span class="attribute-name">id</span>="<a class="attribute-value">snippets</a>"&gt;</span><span></span><span>&lt;/<span class="end-tag">div</span>&gt;</span><span>
<span id="line431"></span>   </span><span>&lt;<span class="start-tag">p</span>&gt;</span><span>
<span id="line432"></span>   </span><span>&lt;<span class="start-tag">pre</span>&gt;</span><span>
<span id="line433"></span>   </span><span>&lt;<span class="start-tag">div</span> <span class="attribute-name">id</span>="<a class="attribute-value">message</a>"&gt;</span><span></span><span>&lt;/<span class="end-tag">div</span>&gt;</span><span>
<span id="line434"></span>   </span><span>&lt;/<span class="end-tag">pre</span>&gt;</span><span>
<span id="line435"></span>   </span><span>&lt;/<span class="end-tag">body</span>&gt;</span><span>
<span id="line436"></span>  </span><span>&lt;/<span class="end-tag">html</span>&gt;</span><span></span></pre><menu type="context" id="actions"><menuitem id="goToLine" label="Go to Line…" accesskey="L"></menuitem><menuitem id="wrapLongLines" label="Wrap Long Lines" type="checkbox"></menuitem><menuitem id="highlightSyntax" label="Syntax Highlighting" type="checkbox" checked="true"></menuitem></menu></body></html>